{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Microsoft Purview - Data Source Onboarding at Scale",
            "steps": [
                {
                    "name": "basics",
                    "label": "Data Landing Zone",
                    "elements": [
                        {
                            "name": "infoBoxDataManagementAnalytics",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "This solution is provided as part of an open source project. The source code is publicly available and can be used for free. For more details and for reporting any issues, please visit the repository 'https://github.com/marvinbuss/PurviewAutomation'",
                                "style": "Info",
                                "uri": "https://github.com/marvinbuss/PurviewAutomation"
                            }
                        },
                        {
                            "name": "deploymentDetails",
                            "label": "Deployment Details",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentDetailsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscription as well as the location to specify the scope of your deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription for your deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, this deployment is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Data Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('australiaeast,canadacentral,northeurope,westeurope,eastus,eastus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "deploymentPrefix",
                            "label": "Deployment Prefix",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentPrefixText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify a prefix and select an environment (Development, Test, Production) which will both be used as a prefix for all resource names. Independent of the environment, the same resources get deployed.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                },
                                {
                                    "name": "resourcePrefix",
                                    "label": "Resource Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "validations": [
                                            {
                                                "regex": "^[a-z0-9]{1,10}$",
                                                "message": "The prefix must be between 1-10 lowercase characters and numbers."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').deploymentPrefix.keyVaultNameApi001.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').deploymentPrefix.storageAccountNameApi001.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('basics').deploymentPrefix.functionsApi001.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi001",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').deploymentPrefix.resourcePrefix, '-', steps('basics').deploymentPrefix.environment, '-vault001')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi001",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').deploymentPrefix.resourcePrefix, steps('basics').deploymentPrefix.environment, 'storage001')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "functionsApi001",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Web/checknameavailability?api-version=2021-02-01')]",
                                        "body": {
                                            "name": "[concat(steps('basics').deploymentPrefix.resourcePrefix, '-', steps('basics').deploymentPrefix.environment, '-function001')]",
                                            "type": "Microsoft.Web/sites"
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "generalSettings",
                    "label": "General Settings",
                    "subLabel": {
                        "preValidation": "Provide configuration settings for your deployment.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "General Settings",
                    "bladeSubtitle": "General Settings",
                    "elements": [
                        {
                            "name": "monitoredSubscriptions",
                            "label": "Monitored Subscriptions",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "eventGridTopicSourceSubscriptions",
                                    "ariaLabel": "Enter Information per Landing Zone",
                                    "label": "Monitored Subscriptions",
                                    "type": "Microsoft.Common.EditableGrid",
                                    "visible": true,
                                    "constraints": {
                                        "width": "Full",
                                        "rows": {
                                            "count": {
                                                "min": 0,
                                                "max": 50
                                            }
                                        },
                                        "columns": [
                                            {
                                                "id": "subscriptionId",
                                                "header": "Subscription",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "subscriptionId",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a subscription...",
                                                    "multiselect": false,
                                                    "selectAll": false,
                                                    "filter": true,
                                                    "filterPlaceholder": "Filter items ...",
                                                    "multiLine": true,
                                                    "constraints": {
                                                        "allowedValues": "[map(steps('generalSettings').monitoredSubscriptions.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            },
                                            {
                                                "id": "location",
                                                "header": "Location",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "location",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a location...",
                                                    "multiselect": false,
                                                    "selectAll": false,
                                                    "filter": true,
                                                    "filterPlaceholder": "Filter items ...",
                                                    "multiLine": true,
                                                    "constraints": {
                                                        "allowedValues": "[map(steps('generalSettings').monitoredSubscriptions.locationsApi.value, (item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "purviewSettings",
                            "label": "Data Governance Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "purviewSettingsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Purview account to which you want to connect Synapse and Data Factory.",
                                        "link": {
                                            "label": "Learn more",
                                            "uri": "https://docs.microsoft.com/en-us/azure/purview/overview"
                                        }
                                    }
                                },
                                {
                                    "name": "purviewId",
                                    "label": "Connect to Purview Account",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Purview account to which you want to connect Synapse and Data Factory.",
                                    "resourceType": "Microsoft.Purview/accounts",
                                    "required": true,
                                    "options": {
                                        "filter": {
                                            "subscription": "all",
                                            "location": "all"
                                        }
                                    }
                                },
                                {
                                    "name": "purviewApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('generalSettings').purviewSettings.purviewId.id, '?api-version=2021-07-01')]"
                                    }
                                },
                                {
                                    "name": "purviewRootCollectionName",
                                    "label": "Purview Root Collection Name",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify the name of the Purview Root Collection within the Purview account that you have selected earlier.",
                                    "constraints": {
                                        "required": true
                                    }
                                },
                                {
                                    "name": "purviewRootCollectionMetadataPolicyId",
                                    "label": "Purview Root Collection Metadata Policy ID",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify the ID of the Purview Root Collection Metadata Policy within the Purview account that you have selected earlier. For more details, please visit: 'https://github.com/marvinbuss/PurviewAutomation/blob/main/docs/Deployment.md#4-update-parameters'",
                                    "constraints": {
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity Settings",
                    "subLabel": {
                        "preValidation": "Provide all connectivity settings for your Data Landing Zone.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
                            "name": "virtualNetwork",
                            "label": "Virtual Network",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "virtualNetworkText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Virtual Network and Subnet for your deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxVirtualNetwork",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Please select the Virtual Network and select subnets within the virtual networks to make sure that you have proper outbound connectivity to the Purview instance that you have selected previously as well as DNS name resolution in place. Please check the infoboxes for the subnets for more details about the subnet configuration.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "virtualNetworkApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('basics').deploymentDetails.subscriptionId, '/providers/Microsoft.Network/virtualNetworks?api-version=2020-11-01')]"
                                    }
                                },
                                {
                                    "name": "virtualNetworkId",
                                    "label": "Virtual Network",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Virtual Network for your Data Product.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').virtualNetwork.virtualNetworkApi.value,(item) => equals(item.location, steps('basics').deploymentDetails.locationName)),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "subnetApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('connectivitySettings').virtualNetwork.virtualNetworkId, '/subnets?api-version=2020-11-01')]"
                                    }
                                },
                                {
                                    "name": "subnetId",
                                    "label": "Services Subnet",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subnet for your Private Endpoints. The subnet must have 'privateEndpointNetworkPolicies' and 'privateLinkServiceNetworkPolicies' set to disabled.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').virtualNetwork.subnetApi.value,(item) => and(equals(item.properties.privateEndpointNetworkPolicies, 'Disabled'), equals(item.properties.privateLinkServiceNetworkPolicies, 'Disabled'), lessOrEquals(int(last(split(item.properties.addressPrefix, '/'))), 27))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "functionSubnetId",
                                    "label": "Function Subnet",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subnet for your Azure Function. The subnet must be delegated to 'Microsoft.Web/serverFarms'.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').virtualNetwork.subnetApi.value,(item) => and(equals(first(item.properties.delegations).properties.serviceName, 'Microsoft.Web/serverFarms'), lessOrEquals(int(last(split(item.properties.addressPrefix, '/'))), 27))),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "privateDnsZones",
                            "label": "Private DNS Zones",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "privateDnsZonesText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the Private DNS Zone settings for your deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxPrivateDnsZone",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "We are deploying all services with private endpoints and disabled public network access to reduce the data exfiltration risk. For each private endpoint, DNS A-records need to be created in a Private DNS Zones. Therefore, these either need to deployed through Azure Policies or you have to provide the Private DNS Zones that should be used for this deployment. We are assuming that all Private DNS Zones are created in the same subscription. Deploying DNS A-Records through Private Endpoints is the recommended solution.",
                                        "style": "Info",
                                        "uri": "https://docs.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/private-link-and-dns-integration-at-scale"
                                    }
                                },
                                {
                                    "name": "automatedPrivateDnsZoneGroups",
                                    "label": "DNS A-Records are deployed through Azure Policy",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "toolTip": "If 'Yes' is selected, Private DNS Zone Groups will not be deployed and we are assuming that this gets created through Azure Policies. If this does not get created, you will not be able to access any resources within this environment.",
                                    "defaultValue": "No",
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "No",
                                                "value": "no"
                                            },
                                            {
                                                "label": "Yes",
                                                "value": "yes"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "subscriptionPrivateDnsZonesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "privateDnsZonesSub",
                                    "label": "Subscription with Private DNS Zones",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Private DNS Zones. If you have deployed the Data Management Landing Zone with a Firewall and Private DNS Zones then select the subscription that you have used for your Data Management Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('connectivitySettings').privateDnsZones.subscriptionPrivateDnsZonesApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZonesApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "[concat(steps('connectivitySettings').privateDnsZones.privateDnsZonesSub, '/providers/Microsoft.Network/privateDnsZones?api-version=2018-09-01')]"
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdKeyVault",
                                    "label": "Private DNS Zone Key Vault (privatelink.vaultcore.azure.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Key Vault (privatelink.vaultcore.azure.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.vaultcore.azure.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdBlob",
                                    "label": "Private DNS Zone Blob Storage (privatelink.blob.core.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for Blob Storage (privatelink.blob.core.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.blob.core.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "privateDnsZoneIdFile",
                                    "label": "Private DNS Zone File Storage (privatelink.file.core.windows.net)",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[equals(steps('connectivitySettings').privateDnsZones.automatedPrivateDnsZoneGroups, 'no')]",
                                    "defaultValue": "",
                                    "toolTip": "Private DNS Zone for File Storage (privatelink.file.core.windows.net).",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('connectivitySettings').privateDnsZones.privateDnsZonesApi.value,(item) => contains(item.name, 'privatelink.file.core.windows.net')),(item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.id, '\",\"description\":\"', 'Resource Group: ', last(take(split(item.id, '/'), 5)), '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "DataManagementAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "Subscription",
            "location": "[steps('basics').deploymentDetails.locationName]",
            "subscriptionId": "[steps('basics').deploymentDetails.subscriptionId]",
            "parameters": {
                "location": "[if(empty(steps('basics').deploymentDetails.locationName), '', steps('basics').deploymentDetails.locationName)]",
                "environment": "[if(empty(steps('basics').deploymentPrefix.environment), '', steps('basics').deploymentPrefix.environment)]",
                "prefix": "[if(empty(steps('basics').deploymentPrefix.resourcePrefix), '', steps('basics').deploymentPrefix.resourcePrefix)]",
                "tags": "[if(not(contains(steps('tags').tagsByResource, 'DataManagementAnalytics')), parse('{}'), first(map(parse(concat('[', string(steps('tags').tagsByResource), ']')), (item) => item.DataManagementAnalytics)))]",
                "repositoryUrl": "https://github.com/marvinbuss/PurviewAutomation",
                "purviewId": "[if(empty(steps('generalSettings').purviewSettings.purviewId.id), '', steps('generalSettings').purviewSettings.purviewId.id)]",
                "purviewManagedStorageId": "[if(empty(steps('generalSettings').purviewSettings.purviewId.id), '', steps('generalSettings').purviewSettings.purviewApi.properties.managedResources.storageAccount)]",
                "purviewManagedEventHubId": "[if(empty(steps('generalSettings').purviewSettings.purviewId.id), '', steps('generalSettings').purviewSettings.purviewApi.properties.managedResources.eventHubNamespace)]",
                "purviewRootCollectionName": "[if(empty(steps('generalSettings').purviewSettings.purviewRootCollectionName), '', steps('generalSettings').purviewSettings.purviewRootCollectionName)]",
                "purviewRootCollectionMetadataPolicyId": "[if(empty(steps('generalSettings').purviewSettings.purviewRootCollectionMetadataPolicyId), '', steps('generalSettings').purviewSettings.purviewRootCollectionMetadataPolicyId)]",
                "eventGridTopicSourceSubscriptions": "[steps('generalSettings').monitoredSubscriptions.eventGridTopicSourceSubscriptions]",
                "createEventSubscription": true,
                "subnetId": "[if(empty(steps('connectivitySettings').virtualNetwork.subnetId), '', steps('connectivitySettings').virtualNetwork.subnetId)]",
                "functionSubnetId": "[if(empty(steps('connectivitySettings').virtualNetwork.functionSubnetId), '', steps('connectivitySettings').virtualNetwork.functionSubnetId)]",
                "privateDnsZoneIdKeyVault": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdKeyVault)]",
                "privateDnsZoneIdBlob": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdBlob), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdBlob)]",
                "privateDnsZoneIdFile": "[if(empty(steps('connectivitySettings').privateDnsZones.privateDnsZoneIdFile), '', steps('connectivitySettings').privateDnsZones.privateDnsZoneIdFile)]"
            }
        }
    }
}